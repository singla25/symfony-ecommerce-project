{% extends 'user/internal_base.html.twig' %}

{% block userContent %}
    <!-- Banner -->
    <div class="position-relative text-center w-100" style="height: 30vh; overflow: hidden;">
        <img src="{{ asset('img/banner/b6.jpg') }}" alt="bannerImage"
             class="w-100 h-100 position-absolute top-0 start-0" style="object-fit: cover; filter: brightness(0.7);">
        <div class="position-absolute top-50 start-50 translate-middle px-5 text-white text-center"
             style="max-width: 600px;">
            <h2 class="fw-bold my-2">#YourCart</h2>
            <p class="mb-2">Review your items, update quantities, and get ready to checkout!</p>
        </div>
    </div>

    <!-- Cart Section -->
    <div class="container my-5">
        <h2 class="text-center mb-4 fw-bold text-success">Your Shopping Cart</h2>

        {% if products|length > 0 %}
            <div class="table-responsive mb-4">
                <table class="table align-middle text-center table-bordered rounded-4 overflow-hidden">
                    <thead class="table-success">
                    <tr>
                        <th>Product</th>
                        <th>Brand</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Subtotal</th>
                        <th>Remove</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% set total = 0 %}
                    {% for product in products %}
                        {% set subtotal = product.price * product.quantity %}
                        {% set total = total + subtotal %}
                        <tr>
                            <td class="text-start">
                                <img src="{{ asset('uploads/products/' ~ product.photo) }}" alt="product" width="60" class="me-2 rounded-2 shadow-sm">
                                <strong>{{ product.productName }}</strong>
                                <br><small class="text-muted">{{ product.productDetail|slice(0, 40) ~ '...' }}</small>
                            </td>
                            <td>{{ product.brandName }}</td>
                            <td>â‚¹{{ product.price }}</td>
                            <td>
                                <form action="{{ path('cart_update_quantity', { id: product.id }) }}" method="post">
                                    <input type="number" name="quantity" value="{{ product.quantity }}" min="1" class="form-control w-75 mx-auto mb-2" onchange="this.form.submit()">
                                </form>
                            </td>
                            <td>â‚¹{{ subtotal }}</td>
                            <td>
                                <a href="{{ path('cart_remove', { id: product.id }) }}" class="btn btn-sm btn-outline-danger">Remove</a>
                            </td>
                        </tr>
                    {% endfor %}
                    <tr class="fw-bold bg-light">
                        <td colspan="4" class="text-end">Total</td>
                        <td colspan="2">â‚¹{{ total }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="text-end">
                <a href="{{ path('checkout') }}" class="btn btn-lg btn-success px-5">Proceed to Checkout</a>
            </div>
        {% else %}
            <div class="text-center py-5">
                <h4 class="text-muted">ðŸ›’ Your cart is empty</h4>
                <a href="{{ path('user_home_page') }}" class="btn btn-outline-primary mt-3">Continue Shopping</a>
            </div>
        {% endif %}
    </div>
{% endblock %}
